<Window
    x:Class="AppRestorer.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ctrl="clr-namespace:AppRestorer.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:AppRestorer"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="App Restorer"
    Width="950"
    Height="550"
    Activated="Window_Activated"
    AllowsTransparency="True"
    Background="Transparent"
    Closing="Window_Closing"
    Deactivated="Window_Deactivated"
    FontFamily="Aptos"
    Icon="/AppRestorer;component/AppIcon.ico"
    Loaded="Window_Loaded"
    ResizeMode="CanMinimize"
    ShowInTaskbar="True"
    WindowStartupLocation="CenterScreen"
    WindowState="Normal"
    WindowStyle="None"
    mc:Ignorable="d">

    <!--  we'll do this in the code-behind  -->
    <!--
    <Window.DataContext>
        <local:MainViewModel />
    </Window.DataContext>
    -->

    <Border
        x:Name="hostBorder"
        MinWidth="350"
        MinHeight="150"
        Margin="10"
        Padding="20"
        Background="{StaticResource ExtraDarkBrush}"
        BorderBrush="{StaticResource NormalBrush}"
        BorderThickness="2"
        CornerRadius="5">
        <Border.Effect>
            <DropShadowEffect
                BlurRadius="6"
                Direction="310"
                Opacity="0.5"
                ShadowDepth="6"
                Color="{StaticResource BackgroundDark}" />
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="22" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!--#region [TitleBar]-->
            <Border
                x:Name="titleBar"
                Grid.Row="0"
                MinWidth="850"
                Margin="-20,0,-20,0"
                BorderBrush="{StaticResource TitleBrushBar}"
                BorderThickness="0,0,0,2"
                CornerRadius="5"
                MouseRightButtonDown="TitleBar_MouseRightButtonDown">
                <!--  Context menu for right-click  -->
                <Border.ContextMenu>
                    <ContextMenu
                        Margin="10"
                        HasDropShadow="False"
                        Opened="TitleBarMenu_Opened">
                        <ContextMenu.Template>
                            <!--
                                You can remove this local control template and just use
                                the style from the App.xaml if you like that one better.
                                If you do, remove the TitleBarMenu_Opened event in the
                                code-behind since the MenuRoot and MenuScale won't exist.
                            -->
                            <ControlTemplate TargetType="ContextMenu">
                                <Border
                                    x:Name="MenuRoot"
                                    Padding="4"
                                    Background="#FF2D2D2D"
                                    CornerRadius="4"
                                    RenderTransformOrigin="0.5,0">
                                    <Border.RenderTransform>
                                        <ScaleTransform x:Name="MenuScale" ScaleX="0.95" ScaleY="0.95" />
                                    </Border.RenderTransform>
                                    <Border.Effect>
                                        <DropShadowEffect
                                            BlurRadius="8"
                                            Opacity="0.7"
                                            ShadowDepth="6"
                                            Color="Black" />
                                    </Border.Effect>
                                    <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" />
                                </Border>
                            </ControlTemplate>
                        </ContextMenu.Template>
                        <MenuItem Command="{Binding DebugCommand, Mode=OneWay}" Header="Debug Test">
                            <MenuItem.Icon>
                                <Image
                                    Width="20"
                                    Height="20"
                                    RenderOptions.BitmapScalingMode="Fant"
                                    Source="/Assets/MenuArrowRight.png" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Command="{Binding MinimizeCommand, Mode=OneWay}" Header="Minimize">
                            <MenuItem.Icon>
                                <Image
                                    Width="20"
                                    Height="20"
                                    RenderOptions.BitmapScalingMode="Fant"
                                    Source="/Assets/MenuArrowRight.png" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Command="{Binding CloseCommand, Mode=OneWay}" Header="Close">
                            <MenuItem.Icon>
                                <Image
                                    Width="20"
                                    Height="20"
                                    RenderOptions.BitmapScalingMode="Fant"
                                    Source="/Assets/MenuArrowRight.png" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <!--
                        <MenuItem Command="{Binding CloseCommand, Mode=OneWay}" Header="Test">
                            <MenuItem.Icon>
                                <Path
                                    Width="20"
                                    Height="20"
                                    Data="M 0 0 L 12 8 L 0 16 Z"
                                    Fill="White"
                                    Stroke="#202020"
                                    StrokeThickness="1" />
                            </MenuItem.Icon>
                        </MenuItem>
                        -->
                    </ContextMenu>
                </Border.ContextMenu>
                <StackPanel
                    VerticalAlignment="Stretch"
                    Orientation="Horizontal"
                    ToolTipService.ToolTip="click &amp; drag to move window">
                    <TextBlock
                        MinWidth="840"
                        MinHeight="30"
                        Margin="12,-12,0,0"
                        FontSize="18"
                        FontWeight="Bold"
                        Foreground="{StaticResource TitleBrush}"
                        Text="{Binding TitleText, Mode=OneWay}">
                        <TextBlock.Effect>
                            <DropShadowEffect
                                BlurRadius="3"
                                Direction="310"
                                Opacity="0.6"
                                ShadowDepth="3"
                                Color="{StaticResource BackgroundDark}" />
                        </TextBlock.Effect>
                    </TextBlock>
                    <Button
                        Width="26"
                        Height="18"
                        Margin="2,-6,0,0"
                        Padding="0"
                        VerticalAlignment="Top"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Top"
                        Command="{Binding MinimizeCommand, Mode=OneWay}"
                        Content="─"
                        FontSize="18"
                        Template="{StaticResource ReformedButton}"
                        ToolTipService.ToolTip="minimize" />
                    <Button
                        Width="26"
                        Height="18"
                        Margin="2,-6,0,0"
                        Padding="0"
                        VerticalAlignment="Top"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Top"
                        Command="{Binding CloseCommand, Mode=OneWay}"
                        Content="✕"
                        FontSize="18"
                        Template="{StaticResource ReformedButton}"
                        ToolTipService.ToolTip="close" />
                </StackPanel>
            </Border>
            <!--#endregion-->

            <DockPanel Grid.Row="1">
                <StackPanel
                    MinWidth="890"
                    Margin="0"
                    VerticalAlignment="Stretch"
                    DockPanel.Dock="Top"
                    Orientation="Horizontal">
                    <!--
                    <Button
                        x:Name="btnSpin"
                        Height="30"
                        Margin="-2,-2,2,0"
                        VerticalAlignment="Top"
                        Click="Spinner_Click"
                        Opacity="0.9"
                        Style="{StaticResource SpinButton}"
                        Visibility="{Binding IsBusy, Mode=OneWay, Converter={StaticResource boolToVisibility}}">
                        <Button.Tag>
                            <ImageSource>/Assets/Spinner5.png</ImageSource>
                        </Button.Tag>
                    </Button>
                    -->
                    <TextBlock
                        x:Name="tbStatus"
                        MinWidth="810"
                        MinHeight="30"
                        Margin="10,10,5,0"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top"
                        FontSize="18"
                        Foreground="{StaticResource TitleBrush}"
                        Text="{Binding StatusText, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}" />

                    <!--
                    <ctrl:TrackRing
                        Width="40"
                        Height="40"
                        Margin="20,0,0,0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Foreground="{StaticResource DotsBrush}"
                        IsActive="{Binding IsBusy, Mode=OneWay}" />
                    -->
                    <!--
                    <ctrl:RingSpinner
                        Width="40"
                        Height="3"
                        HorizontalAlignment="Center"
                        RingBrush="{StaticResource DotsBrush}"
                        RingRadius="2"
                        RingRatio="10"
                        RingThickness="1" />
                    -->
                    <ctrl:DotAnimation
                        x:Name="spinner"
                        Width="68"
                        Height="20"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Center"
                        DotDuration="0.7"
                        DotMinimum="0.6"
                        DotOpacity="0.8"
                        DotRadius="8"
                        DotSize="16"
                        DotSpacing="8"
                        FillColor="{StaticResource DotsBrush}"
                        IsRunning="{Binding IsBusy, Mode=OneWay, FallbackValue=true}"
                        MouseDownCommand="{Binding DebugCommand, Mode=OneWay}">
                        <ctrl:DotAnimation.Easing>
                            <PowerEase EasingMode="EaseOut" Power="0.95" />
                            <!--<CircleEase EasingMode="EaseOut" />-->
                            <!--<SineEase EasingMode="EaseInOut" />-->
                            <!--<QuinticEase EasingMode="EaseInOut" />-->
                            <!--<QuadraticEase EasingMode="EaseInOut" />-->
                            <!--<ExponentialEase EasingMode="EaseInOut" />-->
                            <!--<BackEase Amplitude="0.25" EasingMode="EaseInOut" />-->
                        </ctrl:DotAnimation.Easing>
                    </ctrl:DotAnimation>
                </StackPanel>

                <!--#region [App List]-->
                <Border
                    x:Name="Border"
                    Margin="10,5,10,0"
                    Padding="0"
                    Background="Transparent"
                    BorderBrush="{StaticResource NormalDarkBrush}"
                    BorderThickness="0"
                    CornerRadius="3"
                    DockPanel.Dock="Top">
                    <ListBox
                        x:Name="AppList"
                        MinWidth="870"
                        MinHeight="360"
                        MaxHeight="360"
                        Margin="0"
                        Background="Transparent"
                        BorderThickness="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate DataType="{x:Type local:RestoreItem}">
                                <Border
                                    x:Name="Border"
                                    Margin="1"
                                    Padding="8"
                                    BorderBrush="{StaticResource NormalDarkBrush}"
                                    BorderThickness="1"
                                    CornerRadius="3">
                                    <Border.Effect>
                                        <DropShadowEffect
                                            BlurRadius="3"
                                            Direction="310"
                                            Opacity="0.5"
                                            ShadowDepth="3"
                                            Color="{StaticResource BackgroundDark}" />
                                    </Border.Effect>
                                    <StackPanel Orientation="Horizontal">
                                        <CheckBox
                                            Margin="0"
                                            VerticalAlignment="Center"
                                            VerticalContentAlignment="Center"
                                            Content="{Binding Location}"
                                            FontSize="14"
                                            Foreground="{StaticResource NormalBrush}"
                                            IsChecked="True"
                                            ToolTipService.ToolTip="Application Path" />
                                        <Image
                                            Width="24"
                                            Margin="15,0,0,0"
                                            Cursor="Hand"
                                            MouseDown="Favorite_MouseDown"
                                            RenderOptions.BitmapScalingMode="Fant"
                                            Source="{Binding Favorite, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource boolToImage}}"
                                            ToolTipService.ToolTip="Toggle Favorite" />
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>
                <!--#endregion-->

                <!--#region [Controls]-->
                <StackPanel
                    MinWidth="850"
                    Margin="10,10,10,-12"
                    HorizontalAlignment="Stretch"
                    ButtonBase.Click="CommonClickHandler"
                    DockPanel.Dock="Bottom"
                    Orientation="Horizontal">
                    <Button
                        Width="200"
                        Height="44"
                        Margin="4,2"
                        Click="Restore_Click"
                        Content="Restore Selected"
                        FontSize="15"
                        Template="{StaticResource ReformedButton}" />
                    <Button
                        Width="200"
                        Height="44"
                        Margin="4,2"
                        Click="Invert_Click"
                        Content="Invert Selections"
                        FontSize="15"
                        Template="{StaticResource ReformedButton}" />
                    <Button
                        x:Name="ButtonBackup"
                        Width="200"
                        Height="44"
                        Margin="4,2"
                        Click="LoadBackup_Click"
                        Content="Load Backup"
                        FontSize="15"
                        Template="{StaticResource ReformedButton}" />

                    <!--
                    <ctrl:ActiveArrow
                        Width="38"
                        Height="38"
                        Margin="30,0"
                        HorizontalAlignment="Right"
                        MouseUp="CustomMenu_Click" />
                    -->

                    <ctrl:CandyButton
                        Margin="210,0"
                        VerticalAlignment="Center"
                        ButtonColor="#004891"
                        ButtonSize="32"
                        IsEnabled="{Binding IsBusy, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}"
                        MouseUp="CustomMenu_Click"
                        Text=""
                        TextColor="WhiteSmoke"
                        TextSize="12"
                        ToolTip="Menu" />
                    <!--
                    <ctrl:ColorPreview
                        x:Name="cp1"
                        Title="Brush 1"
                        Brush="{Binding BinderBrush1, Mode=OneWay}"
                        ShowAlpha="False"
                        Tap="TapHandler" />
                    <ctrl:ColorPreview
                        x:Name="cp2"
                        Title="Brush 2"
                        Brush="{Binding BinderBrush2, Mode=OneWay}"
                        ShowAlpha="False"
                        Tap="TapHandler" />
                    -->
                </StackPanel>
                <!--#endregion-->

            </DockPanel>
        </Grid>
    </Border>
</Window>
