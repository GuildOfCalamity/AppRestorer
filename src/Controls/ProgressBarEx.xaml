<UserControl
    x:Class="AppRestorer.Controls.ProgressBarEx"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:AppRestorer.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="50"
    d:DesignWidth="200"
    Loaded="UserControl_Loaded"
    Unloaded="UserControl_Unloaded"
    mc:Ignorable="d">
    <UserControl.Resources>
        <ResourceDictionary>
            <Style x:Key="ProgressBarEx" TargetType="ProgressBar">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ProgressBar">
                            <Grid>
                                <Border
                                    Height="{TemplateBinding Height}"
                                    Background="{TemplateBinding Background}"
                                    CornerRadius="4" />
                                <Canvas x:Name="PART_Canvas">
                                    <Rectangle
                                        x:Name="PART_Indicator"
                                        Width="50"
                                        Height="{TemplateBinding Height}"
                                        Fill="{TemplateBinding Foreground}"
                                        RadiusX="4"
                                        RadiusY="4" />
                                </Canvas>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid>
        <ProgressBar
            x:Name="pbar"
            Height="{Binding BarHeight, Mode=OneWay, FallbackValue=18, RelativeSource={RelativeSource AncestorType=UserControl}}"
            Margin="10,0,0,0"
            VerticalAlignment="Center"
            Background="Transparent"
            BorderThickness="0"
            IsIndeterminate="True"
            Style="{StaticResource ProgressBarEx}">
            <ProgressBar.Foreground>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientBrush.GradientStops>
                        <GradientStopCollection>
                            <GradientStop Offset="0.0" Color="#F9F9F9" />
                            <GradientStop Offset="0.4" Color="{Binding BarColor, Mode=OneWay, FallbackValue=DodgerBlue, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                            <GradientStop Offset="0.81" Color="#242424" />
                            <GradientStop Offset="1.0" Color="Black" />
                        </GradientStopCollection>
                    </GradientBrush.GradientStops>
                </LinearGradientBrush>
            </ProgressBar.Foreground>
        </ProgressBar>
    </Grid>
</UserControl>
